#! /bin/sh
#
# skeleton	example file to build /etc/init.d/ scripts.
#		This file should be used to construct scripts for /etc/init.d.
#
#		Written by Miquel van Smoorenburg <miquels@cistron.nl>.
#		Modified for Debian 
#		by Ian Murdock <imurdock@gnu.ai.mit.edu>.
#
# Version:	@(#)skeleton  1.9  26-Feb-2001  miquels@cistron.nl
#

PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
NAME=tcos-rc2345
DESC=tcos-rc2345

SCRIPT_DIR=/opt/initscripts-tcos/rc2345.d
SCRIPT_DIRS_OPT=/opt/*/tcos/rc2345.d

# Python initscripts need to "import tcos"
export PYTHONPATH="/opt/python-tcos"

# Get LSB functions
. /lib/lsb/init-functions 
. /etc/default/rcS

# Include tcos defaults if available
if [ -f /etc/default/initscripts-common-tcos ] ; then
	. /etc/default/initscripts-common-tcos
fi

function runparts_base() {

	run-parts "$SCRIPT_DIR"
}

function runparts_opt() {

	ERRORLEVEL=0
	for dir in $SCRIPT_DIRS_OPT; do
		if [ -d "$dir" ]; then
			run-parts "$dir"
			if [ $? -ne 0 ]; then
				ERRORLEVEL=65
			fi
		fi
	done
	return $ERRORLEVEL
}

case "$1" in
  start)
	if type usplash_write >/dev/null 2>&1; then
		usplash_write "TIMEOUT 120" || true
	fi
	log_begin_msg "Building TCOS base config..."
	if runparts_base; then
		log_end_msg 0
	else
		log_end_msg $?
	fi

	log_begin_msg "Building TCOS opt config..."
	if runparts_opt; then
		log_end_msg 0
	else
		log_end_msg $?
	fi
	;;
  #stop)
	#echo -n "Stopping $DESC: "
	#start-stop-daemon --stop --quiet --pidfile /var/run/$NAME.pid \
	#	--exec $DAEMON
	#echo "$NAME."
	#;;
  #reload)
	#
	#	If the daemon can reload its config files on the fly
	#	for example by sending it SIGHUP, do it here.
	#
	#	If the daemon responds to changes in its config file
	#	directly anyway, make this a do-nothing entry.
	#
	# echo "Reloading $DESC configuration files."
	# start-stop-daemon --stop --signal 1 --quiet --pidfile \
	#	/var/run/$NAME.pid --exec $DAEMON
  	#;;
  #restart|force-reload)
	#
	#	If the "reload" option is implemented, move the "force-reload"
	#	option to the "reload" entry above. If not, "force-reload" is
	#	just the same as "restart".
	#
	#echo -n "Restarting $DESC: "
	#start-stop-daemon --stop --quiet --pidfile \
	#	/var/run/$NAME.pid --exec $DAEMON
	#sleep 1
	#start-stop-daemon --start --quiet --pidfile \
	#	/var/run/$NAME.pid --exec $DAEMON -- $DAEMON_OPTS
	#echo "$NAME."
	#;;
  *)
	N=/etc/init.d/$NAME
	# echo "Usage: $N {start|stop|restart|reload|force-reload}" >&2
	echo "Usage: $N {start}" >&2
	exit 1
	;;
esac

exit 0
